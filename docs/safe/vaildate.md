# 处理外部数据校验

在任何服务端处理程序外部输入参数的时候，必须注意类型校验。校验内容包括但不限于:数据长度、数据范围、数据类型与格式。以避免攻击或者错误。

2021 年 B 站服务器 OpenResty 崩溃也与此有关。

```lua
local _gcd
_gcd = function (a, b)
    if b == 0 then
        return a
    end
    return _gcd(b, a % b)
emd
```

由于 b 传递为 '0', 导致了 a % b 变为了 nan（NOT A Number）。从而导致死循环，进程 CPU 100% 。

具体可以查看 [2021.07.13 我们是这样崩的](https://www.bilibili.com/read/cv17521097)

当然，前端开发者也需要对用户请求数据进行校验，但是前端校验只能够提供较好的用户体验，无法触达服务端 API。

当然了，服务端开发中考虑类型校验仅仅只是第一步，同时也要考虑用户操作是否可行，是否会因此次操作而造成数据错乱也是需要考虑到的。

例如用户在处理树形结构时候，请求 API 将其变成了图，或者某些节点形成了图。此时无法再建立成树形结构或构建了缺失的树形结构，因此而出错。这也是服务端开发者需要考虑的。


